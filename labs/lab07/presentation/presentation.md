---
## Front matter
lang: ru-RU
title: Лабораторная работа №7
subtitle: Управление журналами событий в системе
author:
  - Сидорова А.В.
institute:
  - Российский университет дружбы народов, Москва, Россия

## i18n babel
babel-lang: russian
babel-otherlangs: english

## Formatting pdf
toc: false
toc-title: Содержание
slide_level: 2
aspectratio: 169
section-titles: true
theme: metropolis
header-includes:
 - \metroset{progressbar=frametitle,sectionpage=progressbar,numbering=fraction}
---

# Информация

## Докладчик

:::::::::::::: {.columns align=center}
::: {.column width="70%"}

  * Сидорова Арина Валерьевна
  * студентка НПИбд-02-24
  * ст.б. 1132242912
  * Российский университет дружбы народов

:::
::::::::::::::

# Вводная часть

## Актуальность

Управление системными журналами (логами) является важнейшей задачей системного администратора для обеспечения мониторинга, диагностики проблем, аудита безопасности и анализа производительности операционной системы.

## Объект и предмет исследования

### Объект исследования

-  Система журналирования событий в операционной системе Linux.

### Предмет исследования

-  Механизмы и инструменты управления системными журналами (rsyslog, journald, journalctl).


## Цели и задачи

**Цель:**
Получить практические навыки работы с системой журналирования событий в Linux, включая настройку rsyslog и работу с journalctl.

**Задачи:**

1. Освоить мониторинг журналов событий в реальном времени.
2. Научиться настраивать правила фильтрации и перенаправления сообщений в rsyslog.
3. Получить навыки работы с утилитой journalctl для просмотра и фильтрации журналов systemd.
4. Настроить постоянное хранение журналов journald.

# Выполнение лабораторной работы

## Мониторинг журнала системных событий в реальном времени

## На второй вкладке терминала запустим мониторинг системных событий в реальном времени.  

![мониторинг](image/1.2.png){#fig:001 width=70%}

## В третьей вкладке терминала вернемся к учётной записи своего пользователя (достаточно нажать Ctrl + d ) 

попробуем получить полномочия администратора, но введем неправильный пароль. Обратим внимание, что во второй вкладке терминала с мониторингом событий или ничего не отобразится, или появится сообщение «FAILED SU (to root) username ...». Отображаемые на экране сообщения также фиксируются в файле /var/log/messages. 

## В третьей вкладке терминала из оболочки пользователя введем logger hello  

![logger hello](image/1.3.png){#fig:002 width=70%}

##Во второй вкладке терминала с мониторингом остановим трассировку файла сообщений мониторинга реального времени

используя Ctrl + c . Затем запустим мониторинг сообщений безопасности (последние 20 строк соответствующего файла
логов). Мы увидите сообщения, которые ранее были зафиксированы во время ошибки авторизации при вводе команды su. 

![tail -n 20 /var/log/secure](image/1.4.png){#fig:003 width=70%}

## Изменение правил rsyslog.conf

## В первой вкладке терминала установим Apache 

![Apache](image/2.1.png){#fig:004 width=70%}

## После окончания процесса установки запустим веб-службу 

![system start, enable](image/2.2.png){#fig:005 width=70%}

## Во второй вкладке терминала посмотрим журнал сообщений об ошибках веб-службы  

![error_log](image/2.3.png){#fig:006 width=70%}

## В третьей вкладке терминала получим полномочия администратора и в файле конфигурации /etc/httpd/conf/httpd.conf в конце добавим строку 

![errorlog syslog:local1](image/2.4.png){#fig:007 width=70%}

Здесь local0 — local7 — это «настраиваемые» средства (объекты), которые syslog предоставляет пользователю для регистрации событий приложения в системном журнале.

## В каталоге /etc/rsyslog.d создадим файл мониторинга событий веб-службы:  

![touch httpd.conf](image/2.5.png){#fig:008 width=70%}

## Открыв его на редактирование, пропишем в нём  

![local1. * -/var/log/httpd-error.log](image/2.6.png){#fig:009 width=70%}

Эта строка позволит отправлять все сообщения, получаемые для объекта local1 (который теперь используется службой httpd), в файл /var/log/httpd-error.log.

## Перейдем в первую вкладку терминала и перезагрузим конфигурацию rsyslogd и веб-службу:  

![restart](image/2.7.png){#fig:010 width=70%}

Все сообщения об ошибках веб-службы теперь будут записаны в файл /var/log/httpd-error.log, что можно наблюдать или в режиме реального времени, используя команду tail с соответствующими параметрами, или непосредственно просматривая указанный файл.

## В третьей вкладке терминала создадим отдельный файл конфигурации для мониторинга отладочной информации: 

![touch debug.conf](image/2.8.png){#fig:011 width=70%}

## В первой вкладке терминала снова перезапустим rsyslogd:  

![restart](image/2.9.png){#fig:012 width=70%}

## Во второй вкладке терминала запустим мониторинг отладочной информации:  

![tail -f /var/log/messages-debug](image/2.10.png){#fig:013 width=70%}

## В третьей вкладке терминала введем: 

![logger -p](image/2.11.png){#fig:014 width=70%}

## В терминале с мониторингом посмотрим сообщение отладки. 

## Использование journalctl

## Во второй вкладке терминала посмотрим содержимое журнала с событиями с момента последнего запуска системы:

journalctl 

![journalctl](image/3.1.png){#fig:015 width=70%}

## Просмотр содержимого журнала без использования пейджера:

journalctl --no-pager  

![journalctl --no-pager](image/3.2.png){#fig:016 width=70%}

##  Режим просмотра журнала в реальном времени:

journalctl -f
Используем Ctrl + c для прерывания просмотра. 

![journalctl -f](image/3.3.png){#fig:017 width=70%}

## Для использования фильтрации просмотра конкретных параметров журнала введем

journalctl и дважды нажмите клавишу Tab .

Просмотрим события для UID0:
journalctl _UID=0 

![journalctl _UID=0](image/3.4.png){#fig:018 width=70%}

## Для отображения последних 20 строк журнала введем

journalctl -n 20  

![journalctl -n 20](image/3.5.png){#fig:019 width=70%}

##  Для просмотра только сообщений об ошибках введем

journalctl -p err 

![journalctl -p err](image/3.6.png){#fig:020 width=70%}

## Для просмотра всех сообщений со вчерашнего дня введем

journalctl --since yesterday 

![journalctl --since yesterday](image/3.7.png){#fig:021 width=70%}

## Используем

journalctl --since yesterday -p err  

![journalctl --since yesterday -p err](image/3.8.png){#fig:022 width=70%}

## Для детальной информации используем

journalctl -o verbose 

![journalctl -o verbose](image/3.9.png){#fig:023 width=70%}

## Для просмотра дополнительной информации о модуле sshd введем

journalctl _SYSTEMD_UNIT=sshd.service  

![journalctl _SYSTEMD_UNIT=sshd.service](image/3.10.png){#fig:024 width=70%}

## Постоянный журнал journald

Запустим терминал и получим полномочия администратора.
Создадим каталог для хранения записей журнала
Скорректируем права доступа для каталога /var/log/journal, чтобы journald смог записывать в него информацию
Для принятия изменений необходимо или перезагрузить систему 
Журнал systemd теперь постоянный. Мы хотим видеть сообщения журнала с момента последней перезагрузки, используем journalctl -b 

![Постоянный журнал journald](image/4.1.png){#fig:025 width=70%}


# Результаты

- Освоены команды tail -f, logger для мониторинга и генерации логов.
- Настроен перенос логов веб-сервиса Apache в отдельный файл через rsyslog.
- Созданы пользовательские правила фильтрации для rsyslog.
- Освоена работа с journalctl для просмотра, фильтрации и анализа журналов.
- Настроено постоянное хранение журналов systemd-journald.

:::

